---
output: 
  html_document:
    css: www/styles.css
    anchor_sections: FALSE
    includes:
        in_header: "header_manual.html"
params:
  year: 2019
  plot: "ACAD-047"
---
<div style="margin-left:-120px;width:100%">
QAQC Report for: <span style="font-weight:bold;">`r params$plot` `r params$year`</span> {.tabset .tabset-pills}
--------------------------------------------------
```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE)
options(knitr.kable.NA = '')
```

```{r import, include = FALSE, cache = FALSE}
forestNETN::importData()
#path = "C:/Forest_Health/exports/NETN"
#forestNETN::importCSV(path = path, zip_name = "NETN_Forest_20210507.zip") # migration check 5/7
```

```{r deps, include = FALSE}
library(tidyverse)
library(forestNETN)
library(htmltools)
library(knitr)
library(kableExtra)

# Set up params (tends to work better)
year = as.numeric(params$year)
plot = params$plot

source("QAQC_report_functions.R")
```

```{r compile_data, include = FALSE}
source("QAQC_report_compile_data.R")
```

```{r stand_tables, include = FALSE}
site_char_tab <- kable(stand2 %>% select(Team, Stand_Structure, Txt_Crown_Closure, Water_on_Plot, 
                              Deer_Browse_Index, Microtopography, Earthworms), 
                       format = "html", align = 'c',
                       col.names = c("Team", "Stand Structure" ,"Crown Closure", "Water on Plot", 
                                     "Deer Browse Index", "Microtopography", "Earthworms")) %>% 
                 kable_styling(fixed_thead = TRUE, bootstrap_options = 'condensed', 
                               position = 'float_left', font_size = 14) %>% 
                 row_spec(0, extra_css = 'border-bottom: 1px solid #000000;') %>% 
                 row_spec(1:2, extra_css = 'border-bottom: 1px solid #CACACA;') %>% 
                 column_spec(2, background = check_dif(stand2, "Stand_Structure")) %>% 
                 column_spec(3, background = check_dif(stand2, "Crown_Closure_code")) %>% 
                 column_spec(4, background = check_dif(stand2, "Water_on_Plot")) %>% 
                 column_spec(5, background = check_dif(stand2, "Deer_Browse_Index")) %>% 
                 column_spec(6, background = check_dif(stand2, "Microtopography")) %>% 
                 column_spec(7, background = check_dif(stand2, "Earthworms")) %>% 
                 row_spec(nrow(stand2), extra_css = "border-bottom: 1px solid #000000;") %>% 
                 column_spec(1, border_left = TRUE) %>% 
                 column_spec(1:7, border_right = TRUE)

pct_tab <- kable(stand2 %>% select(Team, Txt_Understory_Low, Txt_Understory_Mid, Txt_Understory_High,
                                   Txt_Bare_Soil, Txt_Rock, Txt_Trampled, Txt_Water,
                                   Txt_Bryophyte, Txt_Lichen),
                 format = 'html', align = 'c',
                 col.names = c("Team", "% Vasc. Low", "% Vasc. Mid", "% Vasc. High", 
                               "% Bare Soil", "% Rock", "% Trampled", "% Water",
                               "% Non-Vascular", "% Lichen")) %>% 
                 kable_styling(fixed_thead = TRUE, bootstrap_options = 'condensed', 
                               position = 'float_left', font_size = 14) %>% 
                 row_spec(0, extra_css = 'border-bottom: 1px solid #000000;') %>% 
                 row_spec(1:2, extra_css = 'border-bottom: 1px solid #CACACA;') %>%
                 column_spec(2, background = check_dif(stand2, "Understory_Low_code")) %>% 
                 column_spec(3, background = check_dif(stand2, "Understory_Mid_code")) %>% 
                 column_spec(4, background = check_dif(stand2, "Understory_High_code")) %>% 
                 column_spec(5, background = check_dif(stand2, "Bare_Soil_code")) %>% 
                 column_spec(6, background = check_dif(stand2, "Rock_code")) %>% 
                 column_spec(7, background = check_dif(stand2, "Trampled_code")) %>% 
                 column_spec(8, background = check_dif(stand2, "Water_code")) %>% 
                 column_spec(9, background = check_dif(stand2, "Bryophyte_code")) %>% 
                 column_spec(10, background = check_dif(stand2, "Lichen_code")) %>% 
                 row_spec(nrow(stand2), extra_css = "border-bottom: 1px solid #000000;") %>% 
                 column_spec(2:10, border_right = TRUE, extra_css = "border-right: 1px solid #CACACA;") %>% 
                 column_spec(1:2, border_left = TRUE) %>% column_spec(10, border_right = TRUE)

row_changes_tr <- sapply(seq_along(tree_hts_wide), function(x){
  check = ifelse(tree_hts_wide$CrownClassLabel[x] != tree_hts_wide$CrownClassLabel[x + 1], x, NA)
  }) %>% data.frame() %>% na.omit(.)

trht_tab <- kable(tree_hts_wide %>% select(TagCode, CrownClassLabel, Crew, QAQC, ht_diff),
                  format = 'html', align = 'c',
                  table.attr = "style='width:48%;'",
                  col.names = c("Tree #", "Crown Class", "Crew", "QAQC", "Diff (m)")) %>%
            kable_styling(fixed_thead = TRUE, bootstrap_options = 'condensed', full_width = FALSE,
                          position = 'left', font_size = 14) %>%
                  row_spec(0, extra_css = 'border-bottom: 1px solid #000000;') %>%
                  row_spec(1:(nrow(tree_hts_wide)-1), extra_css = 'border-bottom: 1px solid #CACACA;') %>%
                  column_spec(3:5, background = case_when(tree_hts_wide$ht_diff > 1 ~ diff_bad,
                                                        between(tree_hts_wide$ht_diff, 0.2, 1) ~ diff_ok,
                                                        between(tree_hts_wide$ht_diff, 0, 0.2) ~ '#ffffff',
                                                        is.na(tree_hts_wide$ht_diff) ~ diff_bad,
                                                        TRUE ~ "#ffffff")) %>%
                  row_spec(nrow(tree_hts_wide), extra_css = "border-bottom: 1px solid #000000;") %>%
                  row_spec(row_changes_tr[,1], extra_css = "border-bottom: 1px solid #000000;") %>%
                  column_spec(c(1, 2, 3, 5), border_left = TRUE) %>% column_spec(5, border_right = TRUE) %>%
                  column_spec(c(3), border_right = TRUE, extra_css = "border-right: 1px solid #CACACA;")

dist_tab <- kable(dist %>% select(Team, DisturbanceSummary, ThresholdLabel, DisturbanceCoverClassLabel),
                  format = 'html', align = 'c',
                  table.attr = "style='width:48%;'",
                  col.names = c("Team", "Disturbance", "Threshold", "Cover Class")) %>% 
            kable_styling(fixed_thead = TRUE, bootstrap_options = 'condensed', full_width = FALSE, 
                          position = 'left', font_size = 14) %>% 
            row_spec(0, extra_css = 'border-bottom: 1px solid #000000;') %>% 
            row_spec(1:2, extra_css = 'border-bottom: 1px solid #CACACA;') %>%
            column_spec(2, background = check_dif(dist, "DisturbanceLabel")) %>% 
            column_spec(3, background = check_dif(dist, "ThresholdLabel")) %>% 
            column_spec(4, background = check_dif(dist, "DisturbanceCoverClassCode")) %>% 
            row_spec(nrow(dist), extra_css = "border-bottom: 1px solid #000000;") %>% 
            column_spec(c(1, 2), border_left = TRUE) %>% column_spec(4, border_right = TRUE) %>% 
            column_spec(2:3, border_right = TRUE, extra_css = "border-right: 1px solid #CACACA")

```

```{r tree_tables, include = FALSE}
tree_tab <- kable(tree_wide2 %>% select(-fol_diff, -dec_diff, -HWA_diff, -BBD_diff), 
                  format = 'html', align = 'c',
                  col.names = c("Tree", "Species", "Crew", "QAQC", "Diff", "Crew", "QAQC",
                                "Crew", "QAQC", "Crew", "QAQC", "Crew", "QAQC",
                                "Crew", "QAQC", "Crew", "QAQC", "Crew", "QAQC")) %>% 
            kable_styling(fixed_thead = TRUE, bootstrap_options = 'condensed', 
                          full_width = FALSE, position = 'left', font_size = 13) %>% 
            add_header_above(c("", "", "DBH" = 3, "Verified" = 2, "Status" = 2, "Crown Class" = 2,
                               "Total Foliage" = 2, "Decay" = 2, "HWA" = 2, "BBD" = 2),
                             extra_css = "border-bottom: 1px solid #000000; border-right: 3px solid #ffffff;",
                             line = FALSE) %>% 
            row_spec(0, extra_css = 'border-bottom: 1px solid #000000;') %>%              
            row_spec(1:nrow(tree_wide2), extra_css = 'border: 1px solid #CACACA;') %>% 
            column_spec(1, border_left = TRUE) %>% 
            column_spec(2, border_right = TRUE) %>% 
            column_spec(3:5, background = check_dbh(tree_wide2, "DBH_diff")) %>% 
            column_spec(seq(5, 19, 2), border_right = TRUE) %>% 
            column_spec(6:7, background = 
                          ifelse(!tree_wide2$IsDBHVerified_C %in% tree_wide2$IsDBHVerified_Q, diff_ok, "#ffffff")) %>% 
            column_spec(8:9, background = 
                          case_when(substr(tree_wide2$TreeStatusCode_C, 1, 1) != "R" &
                                    substr(tree_wide2$TreeStatusCode_C, 1, 1) != 
                                      substr(tree_wide2$TreeStatusCode_Q, 1, 1) ~ diff_bad,
                                    substr(tree_wide2$TreeStatusCode_C, 1, 1) != "R" &
                                    tree_wide2$TreeStatusCode_C != tree_wide2$TreeStatusCode_Q ~ diff_ok,
                                    TRUE ~ "#ffffff")) %>% 
            column_spec(10:11, background = 
                          case_when(abs(tree_wide2$CrownClassCode_C - tree_wide2$CrownClassCode_Q) > 1 ~ diff_bad,
                                    abs(tree_wide2$CrownClassCode_C - tree_wide2$CrownClassCode_Q) == 1 ~ diff_ok,
                                    TRUE ~ "#ffffff")) %>% 
            column_spec(12:13, background = 
                          case_when(tree_wide$fol_diff > 1 ~ diff_bad,
                                    tree_wide$fol_diff == 1 ~ diff_ok,
                                    TRUE ~ "#ffffff")) %>% 
            column_spec(14:15, background = 
                          case_when(tree_wide2$dec_diff > 1 ~ diff_bad,
                                    tree_wide2$dec_diff == 1 ~ diff_ok,
                                    TRUE ~ "#ffffff")) %>% 
            column_spec(16:17, background = 
                          case_when(tree_wide2$HWA_diff > 1 ~ diff_bad,
                                    tree_wide2$HWA_diff == 1 ~ diff_ok,
                                    TRUE ~ "#ffffff")) %>% 
            column_spec(18:19, background = 
                          case_when(tree_wide2$BBD_diff > 1 ~ diff_bad,
                                    tree_wide2$BBD_diff == 1 ~ diff_ok,
                                    TRUE ~ "#ffffff"))  %>% 
            row_spec(nrow(tree_wide2), extra_css = "border-bottom: 1px solid #000000;")

trcond_tab <- kable(trcond_wide %>% select(-Status, -cond_diff), 
                    format = 'html', align = 'c',
                    col.names = c("Tree", rep(c("Crew", "QAQC"), 24))) %>% 
              kable_styling(fixed_thead = TRUE, bootstrap_options = 'condensed', 
                            full_width = FALSE, position = 'left', font_size = 12) %>%
              add_header_above(c("", "# Conds" = 2, "H" = 2, "NO" = 2, "AD" = 2, "BBD" = 2, "BC" = 2, 
                                 "BWA" = 2, "CAVL" = 2, "CAVS" = 2, "CW" = 2,  "DBT" = 2, "DOG" = 2, 
                                 "EAB" = 2, "EB" = 2, "EHS" = 2, "G" = 2, "GM" = 2, "HWA" = 2,
                                 "ID" = 2, "OTH" = 2, "RPS" = 2, "SB" = 2, "VINE_B" = 2, "VINE_C" = 2),
                             extra_css = "border-bottom: 1px solid #000000; border-right: 3px solid #ffffff;",
                             line = FALSE) %>% 
              row_spec(0, extra_css = 'border-bottom: 1px solid #000000;') %>% 
              row_spec(1:nrow(trcond_wide), extra_css = 'border: 1px solid #CACACA;') %>% 
              row_spec(nrow(trcond_wide), extra_css = "border-bottom: 1px solid #000000;") %>%
              column_spec(1, border_left = TRUE, border_right = TRUE, 
                          extra_css = "border-left: 1px solid #000000; border-right: 2px solid #000000;",
                          background = ifelse(trcond_wide$Status == "dead", "#DADADA", "#ffffff")) %>%
              column_spec(3, border_right = TRUE, extra_css = "border-right: 2px solid #000000;") %>% 
              column_spec(2:3, background = case_when(trcond_wide$cond_diff > 1 ~ diff_bad,
                                                      trcond_wide$cond_diff == 1 ~ diff_ok,
                                                      trcond_wide$cond_diff == 0 ~ "#ffffff",
                                                      TRUE ~ "#ffffff"), 
                          bold = TRUE) %>%
              column_spec(4:5, background = check_cond(trcond_wide, "H_C", "H_Q")) %>% 
              column_spec(4, border_left = TRUE) %>% column_spec(5, border_right = TRUE) %>%
              column_spec(6:7, background = check_cond(trcond_wide, "NO_C", "NO_Q")) %>% 
              column_spec(seq(7, 49, 2), border_right = TRUE) %>%
              column_spec(8:9,   background = check_cond(trcond_wide, "AD_C", "AD_Q")) %>% 
              column_spec(10:11, background = check_cond(trcond_wide, "BBD_C", "BBD_Q")) %>% 
              column_spec(12:13, background = check_cond(trcond_wide, "BC_C", "BC_Q")) %>% 
              column_spec(14:15, background = check_cond(trcond_wide, "BWA_C", "BWA_Q")) %>% 
              column_spec(16:17, background = check_cond(trcond_wide, "CAVL_C", "CAVL_Q")) %>% 
              column_spec(18:19, background = check_cond(trcond_wide, "CAVS_C", "CAVS_Q")) %>% 
              column_spec(20:21, background = check_cond(trcond_wide, "CW_C", "CW_Q")) %>% 
              column_spec(22:23, background = check_cond(trcond_wide, "DBT_C", "DBT_Q")) %>% 
              column_spec(24:25, background = check_cond(trcond_wide, "DOG_C", "DOG_Q")) %>% 
              column_spec(26:27, background = check_cond(trcond_wide, "EAB_C", "EAB_Q")) %>% 
              column_spec(28:29, background = check_cond(trcond_wide, "EB_C", "EB_Q")) %>% 
              column_spec(30:31, background = check_cond(trcond_wide, "EHS_C", "EHS_Q")) %>% 
              column_spec(32:33, background = check_cond(trcond_wide, "G_C", "G_Q")) %>% 
              column_spec(34:35, background = check_cond(trcond_wide, "GM_C", "GM_Q")) %>% 
              column_spec(36:37, background = check_cond(trcond_wide, "HWA_C", "HWA_Q")) %>% 
              column_spec(38:39, background = check_cond(trcond_wide, "ID_C", "ID_Q")) %>% 
              column_spec(40:41, background = check_cond(trcond_wide, "OTH_C", "OTH_Q")) %>% 
              column_spec(42:43, background = check_cond(trcond_wide, "RPS_C", "RPS_Q")) %>% 
              column_spec(44:45, background = check_cond(trcond_wide, "SB_C", "SB_Q")) %>% 
              column_spec(46:47, background = check_cond(trcond_wide, "VIN_B_C", "VIN_B_Q")) %>% 
              column_spec(48:49, background = check_cond(trcond_wide, "VIN_C_C", "VIN_C_Q")) %>% 
              scroll_box(width = "1100px")

folcond_tab <- kable(folcond_wide %>% select(TagCode:Txt_Leaves_Aff_W_Q), 
                     format = 'html', align = 'c',
                     col.names = c("Tree", rep(c("Crew", "QAQC"), 10))) %>% 
              kable_styling(fixed_thead = TRUE, bootstrap_options = 'condensed', 
                            full_width = FALSE, position = 'left', font_size = 13) %>% 
              add_header_above(c("", "% Lvs. Aff." = 2, "% Leaf Area" = 2, "% Lvs. Aff." = 2, "% Leaf Area" = 2,
                                 "% Lvs. Aff." = 2, "% Lvs. Aff." = 2, "% Leaf Area" = 2, "% Lvs. Aff." = 2,
                                 "% Lvs. Aff." = 2, "% Lvs. Aff." = 2),
                             extra_css = "border-bottom: 1px solid #000000; border-right: 3px solid #ffffff;",
                             line = FALSE) %>% 
              add_header_above(c("", "Chlorosis" = 4, "Holes" = 4, "Loss" = 2, "Necrosis" = 4, 
                                 "Other" = 2, "Small Lvs" = 2, "Wilting" = 2),
                             extra_css = "border-bottom: 1px solid #000000; border-right: 3px solid #ffffff;",
                             line = FALSE) %>% 
              row_spec(0, extra_css = 'border-bottom: 1px solid #000000;') %>% 
              row_spec(1:nrow(folcond_wide), extra_css = 'border: 1px solid #CACACA;') %>% 
              row_spec(nrow(folcond_wide), extra_css = "border-bottom: 1px solid #000000;") %>%
              column_spec(1, border_left = TRUE, border_right = TRUE, 
                          extra_css = "border-left: 1px solid #000000; border-right: 1px solid #000000;") %>%
              column_spec(2:3, background = 
                            check_covclass(folcond_wide, "Leaves_Aff_C_code_C", "Leaves_Aff_C_code_Q")) %>%           
              column_spec(seq(3, 21, 2), border_right = TRUE) %>% 
              column_spec(4:5, background = 
                            check_covclass(folcond_wide, "Leaf_Area_C_code_C", "Leaf_Area_C_code_Q")) %>% 
              column_spec(6:7, background = 
                            check_covclass(folcond_wide, "Leaves_Aff_H_code_C", "Leaves_Aff_H_code_Q")) %>% 
              column_spec(8:9, background = 
                            check_covclass(folcond_wide, "Leaf_Area_H_code_C", "Leaf_Area_H_code_Q")) %>% 
              column_spec(10:11, background = 
                            check_covclass(folcond_wide, "Leaves_Aff_L_code_C", "Leaves_Aff_L_code_Q")) %>% 
              column_spec(12:13, background = 
                            check_covclass(folcond_wide, "Leaves_Aff_N_code_C", "Leaves_Aff_N_code_Q")) %>% 
              column_spec(14:15, background = 
                            check_covclass(folcond_wide, "Leaf_Area_N_code_C", "Leaf_Area_N_code_Q")) %>% 
              column_spec(16:17, background = 
                            check_covclass(folcond_wide, "Leaves_Aff_O_code_C", "Leaves_Aff_O_code_Q")) %>% 
              column_spec(18:19, background = 
                            check_covclass(folcond_wide, "Leaves_Aff_S_code_C", "Leaves_Aff_S_code_Q")) %>% 
              column_spec(20:21, background = 
                            check_covclass(folcond_wide, "Leaves_Aff_W_code_C", "Leaves_Aff_W_code_Q")) %>% 
              scroll_box(width = "1100px")
  
```

```{r micro_tables, include = FALSE}
row_changes_saps <- sapply(1:nrow(saps), function(x){
  check = ifelse(saps$MicroplotCode[x] != saps$MicroplotCode[x + 1], x, NA)
  }) %>% data.frame() %>% na.omit(.) 

sap_tab <- kable(saps, format = 'html', align = 'c', #table.attr = "style='width:48%;'",
                 col.names = c("Team", "SQ", "Micro", "Species", "DBH")) %>% 
           kable_styling(fixed_thead = TRUE, bootstrap_options = 'condensed', 
                         full_width = TRUE, position = 'left', font_size = 14) %>% 
           row_spec(0, extra_css = 'border-bottom: 1px solid #000000;') %>% 
           row_spec(1:nrow(saps), extra_css = 'border: 1px solid #CACACA;') %>% 
           row_spec(nrow(saps), extra_css = "border-bottom: 1px solid #000000;") %>% 
           column_spec(1:ncol(saps), background = ifelse(saps$Team == "Crew", "#ffffff", "#DADADA")) %>% 
           column_spec(1, border_left = TRUE) %>% column_spec(5, border_right = TRUE) %>% 
           row_spec(row_changes_saps[,1], extra_css = "border-bottom: 1px solid #000000;")
           
sap_sum_tab <- kable(sap_sum %>% select(-dbh_diff), format = 'html', align = 'c', #table.attr = "style='width:48%;'",
                     col.names = c("Micro", "#Saps-C", "#Saps-Q", "DBH mean-C", "DBH mean-Q")) %>% 
               kable_styling(fixed_thead = TRUE, bootstrap_options = "condensed", 
                             full_width = TRUE, position = 'left', font_size = 14) %>% 
               row_spec(0, extra_css = 'border-bottom: 1px solid #000000;') %>% 
               row_spec(1:nrow(sap_sum), extra_css = 'border: 1px solid #CACACA;') %>% 
               row_spec(nrow(sap_sum), extra_css = "border-bottom: 1px solid #000000;") %>% 
               column_spec(1, border_left = TRUE) %>% 
               column_spec(2:3, background = check_stems(sap_sum, "num_saps_Crew", "num_saps_QAQC")) %>% 
               column_spec(4:5, background = check_dbh(sap_sum, "dbh_diff")) %>% 
               column_spec(seq(1, 5, 2), border_right = TRUE) 

row_changes <- sapply(1:nrow(shrubs_full), function(x){
  check = ifelse(shrubs_full$Micro[x] != shrubs_full$Micro[x + 1], x, NA)
  }) %>% data.frame() %>% na.omit(.) 

shrub_tab <- kable(shrubs_full %>% select(-pct_class_C, -pct_class_Q), format = 'html', align = 'c',
                   col.names = c("Micro", "Species", "% Cover C", "% Cover Q")) %>% 
             kable_styling(fixed_thead = TRUE, bootstrap_options = "condensed", 
                           full_width = TRUE, position = 'left', font_size = 14) %>% 
             column_spec(3:4, background = check_covclass(shrubs_full, "pct_class_C", "pct_class_Q")) %>% 
             row_spec(c(0, nrow(shrubs_full)), extra_css = "border-bottom: 1px solid #000000;") %>% 
             row_spec(row_changes[,1], extra_css = "border-bottom: 1px solid #000000;") %>% 
             column_spec(1, border_left = TRUE) %>% 
             column_spec(c(1, 2, 3, 4), border_right = TRUE) 
             
row_changes2 <- sapply(1:nrow(seeds_comp), function(x){
  check = ifelse(seeds_comp$MicroplotCode[x] != seeds_comp$MicroplotCode[x + 1], x, NA)
  }) %>% data.frame() %>% na.omit(.) 

seeds_tab <- kable(seeds_comp %>% select(-tot_seeds_C, -tot_seeds_Q), format = 'html', align = 'c', 
                   col.names = c("Micro", "Species", rep(c("Crew", "QAQC"), 4))) %>% 
             kable_styling(fixed_thead = TRUE, bootstrap_options = "condensed", 
                           full_width = TRUE, position = 'left', font_size = 14) %>% 
             add_header_above(c("", "", "15 - 30cm" = 2, "30 - 100cm" = 2, "100 - 150cm" = 2,
                                "> 150cm" = 2),
                             extra_css = "border-bottom: 1px solid #000000; border-right: 3px solid #ffffff;",
                             line = FALSE) %>% 
             column_spec(1, border_left = TRUE) %>% 
             column_spec(c(1, seq(2, 10, 2)), border_right = TRUE) %>%
             column_spec(seq(3, 9, 2), border_right = TRUE, extra_css = 'border-right: 1px solid #CACACA;') %>% 
             column_spec(2, background = ifelse(!(seeds_comp$ScientificName %in% "None present") & 
                                                 (seeds_comp$tot_seeds_C == 0 | seeds_comp$tot_seeds_Q == 0), 
                                                  diff_bad, "#ffffff")) %>% 
             column_spec(3:4, background = check_stems_small(seeds_comp, "sd_15_30cm_C", "sd_15_30cm_Q")) %>% 
             column_spec(5:6, background = check_stems(seeds_comp, "sd_30_100cm_C" ,"sd_30_100cm_Q")) %>% 
             column_spec(7:8, background = check_stems(seeds_comp, "sd_100_150cm_C" ,"sd_100_150cm_Q")) %>% 
             column_spec(9:10, background = check_stems(seeds_comp, "sd_p150cm_C" ,"sd_p150cm_Q")) %>% 
             row_spec(c(0, nrow(seeds_comp)), extra_css = "border-bottom: 1px solid #000000;") %>% 
             row_spec(row_changes2[,1], extra_css = "border-bottom: 1px solid #000000;")

regen_tab <- kable(regen_comp %>% select(-seed_pct_diff, -sap_pct_diff, -stock_pct_diff), 
                   format = 'html', align = 'c',
                   col.names = c("Species", rep(c("Crew", "QAQC"), 3))) %>% 
             kable_styling(fixed_thead = TRUE, bootstrap_options = "condensed", 
                           full_width = TRUE, position = 'left', font_size = 14) %>% 
             add_header_above(c("", "Avg. Seedling Count" = 2, "Avg. Sapling Count" = 2, "Stocking Index" = 2),
                             extra_css = "border-bottom: 1px solid #000000; border-right: 3px solid #ffffff;",
                             line = FALSE) %>% 
             column_spec(2:3, background = check_pct_diff(regen_comp, "seed_den_C", "seed_den_Q", "seed_pct_diff")) %>% 
             column_spec(4:5, background = check_pct_diff(regen_comp, "sap_den_C", "sap_den_Q", "sap_pct_diff")) %>% 
             column_spec(6:7, background = check_pct_diff(regen_comp, "stock_C", "stock_Q", "stock_pct_diff")) %>% 
             row_spec(c(0, nrow(regen_comp)), extra_css = "border-bottom: 1px solid #000000;") %>% 
             column_spec(c(1, seq(3, 7, 2)), border_right = TRUE) %>%
             column_spec(seq(2, 6, 2), border_right = TRUE, extra_css = "border-right: 1px solid #CACACA;") %>% 
             column_spec(1, border_left = TRUE)


```

```{r quad_tables, include = FALSE}
chr_tab <- kable(quad_chr_comp %>% select(Character:UL_Q), format = 'html', align = 'c', 
                 col.names = c("Character", rep(c("Crew", "QAQC"), 8))) %>% 
           kable_styling(fixed_thead = TRUE, bootstrap_options = 'condensed',
                         full_width = TRUE, position = 'left', font_size = 12) %>% 
           add_header_above(c("", "UC" = 2, "UR" = 2, "MR" = 2, "BR" = 2, "BC" = 2, "BL" = 2, "ML" = 2, "UL" = 2),
                            extra_css = "border-bottom: 1px solid #000000; border-right: 3px solid #ffffff;",
                            line = FALSE) %>% 
           column_spec(2:3, background = check_dif_col(quad_chr_comp, "UC_dif")) %>% 
           column_spec(4:5, background = check_dif_col(quad_chr_comp, "UR_dif")) %>% 
           column_spec(6:7, background = check_dif_col(quad_chr_comp, "MR_dif")) %>% 
           column_spec(8:9, background = check_dif_col(quad_chr_comp, "BR_dif")) %>% 
           column_spec(10:11, background = check_dif_col(quad_chr_comp, "BC_dif")) %>% 
           column_spec(12:13, background = check_dif_col(quad_chr_comp, "BL_dif")) %>%
           column_spec(14:15, background = check_dif_col(quad_chr_comp, "ML_dif")) %>% 
           column_spec(16:17, background = check_dif_col(quad_chr_comp, "UL_dif")) %>% 
           row_spec(c(0, nrow(quad_chr_comp)), extra_css = "border-bottom: 1px solid #000000;") %>% 
           column_spec(c(1, seq(3, 17, 2)), border_right = TRUE) %>%
           column_spec(seq(2, 16, 2), border_right = TRUE, extra_css = "border-right: 1px solid #CACACA;") %>% 
           column_spec(1, border_left = TRUE)

missed_leg <- kable(data.frame(missed_C = c("Crew Missed"), missed_Q = c("QAQC Missed")), 
                    col.names = c("", ""), format = 'html', align = 'c') %>% 
              kable_styling(fixed_thead = FALSE, bootstrap_options = 'condensed',
                            full_width = FALSE, position = 'left', font_size = 12) %>% 
              column_spec(1, background = "#ACC1DE") %>% 
              column_spec(2, background = "#DEACAC")

spp_tab <- kable(quad_spp_comp2 %>% select(ScientificName:UL_Q), format = 'html', align = 'c',
                 col.names = c("Species", "Germ", rep(c("Crew", "QAQC"), 8))) %>% 
           kable_styling(fixed_thead = TRUE, bootstrap_options = 'condensed',
                         full_width = TRUE, position = 'left', font_size = 12) %>% 
           add_header_above(c("", "", "UC" = 2, "UR" = 2, "MR" = 2, "BR" = 2, "BC" = 2, "BL" = 2, "ML" = 2, "UL" = 2),
                            extra_css = "border-bottom: 1px solid #000000; border-right: 3px solid #ffffff;",
                            line = FALSE) %>% 
           column_spec(3:4, background = check_dif_col(quad_spp_comp2, "UC_dif")) %>% 
           column_spec(5:6, background = check_dif_col(quad_spp_comp2, "UR_dif")) %>% 
           column_spec(7:8, background = check_dif_col(quad_spp_comp2, "MR_dif")) %>% 
           column_spec(9:10, background = check_dif_col(quad_spp_comp2, "BR_dif")) %>% 
           column_spec(11:12, background = check_dif_col(quad_spp_comp2, "BC_dif")) %>% 
           column_spec(13:14, background = check_dif_col(quad_spp_comp2, "BL_dif")) %>%
           column_spec(15:16, background = check_dif_col(quad_spp_comp2, "ML_dif")) %>% 
           column_spec(17:18, background = check_dif_col(quad_spp_comp2, "UL_dif")) %>% 
           row_spec(c(0, nrow(quad_spp_comp2)), extra_css = "border-bottom: 1px solid #000000;") %>% 
           column_spec(c(1, seq(2, 18, 2)), border_right = TRUE) %>%
           column_spec(seq(3, 17, 2), border_right = TRUE, extra_css = "border-right: 1px solid #CACACA;") %>% 
           column_spec(1, border_left = TRUE, background = case_when(quad_spp_comp2$spp_miss_C == 1 ~ "#ACC1DE",
                                                                     quad_spp_comp2$spp_miss_Q == 1 ~ "#DEACAC",
                                                                     TRUE ~ "#ffffff")) %>% 
           scroll_box(width = "1100px")

spp_sum_tab <- kable(quad_sum_comp2 %>% select(-pct_diff_cov, -pct_diff_freq), 
                     col.names = c("Species", "Germ", "Crew", "QAQC", "Crew", "QAQC"),
                     format = 'html', align = 'c') %>% 
               kable_styling(fixed_thead = TRUE, bootstrap_options = 'condensed',
                             full_width = FALSE, position = 'left', font_size = 14) %>% 
               add_header_above(c("", "", "Avg. % Cover" = 2, "Quad % Freq." = 2),
                               extra_css = "border-bottom: 1px solid #000000; border-right: 3px solid #ffffff;",
                               line = FALSE) %>% 
               row_spec(c(0, nrow(quad_sum_comp2)), extra_css = "border-bottom: 1px solid #000000;") %>% 
               row_spec(c(2: nrow(quad_sum_comp2) - 1), extra_css = "border-bottom: 1px solid #CACACA;") %>% 
               column_spec(3:4, background = 
                             check_pct_diff(quad_sum_comp2, "quad_avg_cov_C", "quad_avg_cov_Q", "pct_diff_cov")) %>% 
               column_spec(5:6, background = 
                             check_pct_diff(quad_sum_comp2, "quad_pct_freq_C", "quad_pct_freq_Q", "pct_diff_freq")) %>% 
               column_spec(1, background = case_when(quad_sum_comp2$quad_pct_freq_C == 0 & 
                                                       quad_sum_comp2$IsGerminant == 0 ~ "#ACC1DE",
                                                     quad_sum_comp2$quad_pct_freq_Q == 0 & 
                                                       quad_sum_comp2$IsGerminant == 0 ~ "#DEACAC",
                                                     TRUE ~ "#ffffff")) %>% 
               column_spec(1, border_left = T) %>% 
               column_spec(c(1, seq(2, 6, 2)), border_right = TRUE) %>%
               column_spec(seq(3, 5, 2), border_right = TRUE, extra_css = "border-right: 1px solid #CACACA;")


```

```{r addspp_tables, include = FALSE}
addspp_tab <- kable(spp_list_comp2 %>% select(-missed_C, -missed_Q), format = 'html', align = 'c',
                    col.names = c("Species", rep(c("Crew", "QAQC"), 4))) %>% 
              kable_styling(fixed_thead = TRUE, bootstrap_options = 'condensed', full_width = FALSE,
                            position = 'left', font_size = 14) %>% 
              add_header_above(c("", "Tree Data" = 2, "Microplots" = 2, "Quadrats" = 2, "Add.Spp." = 2),
                            extra_css = "border-bottom: 1px solid #000000; border-right: 3px solid #ffffff;",
                            line = FALSE) %>% 
              column_spec(1, background = case_when(spp_list_comp2$missed_C == 1 ~ "#ACC1DE",
                                                    spp_list_comp2$missed_Q == 1 ~ "#DEACAC",
                                                     TRUE ~ "#ffffff")) %>% 
              row_spec(c(0, nrow(spp_list_comp2)), extra_css = "border-bottom: 1px solid #000000;") %>% 
              row_spec(c(2: nrow(spp_list_comp2) - 1), extra_css = "border-bottom: 1px solid #CACACA;") %>% 
              column_spec(1, border_left = T) %>% 
              column_spec(c(1, seq(3, 9, 2)), border_right = TRUE) %>%
              column_spec(seq(2, 8, 2), border_right = TRUE, extra_css = "border-right: 1px solid #CACACA;")               

```

```{r cwd_tables, include = FALSE}
row_changes_cwd <- sapply(1:nrow(cwd_raw2), function(x){
  check = ifelse(cwd_raw2$Transect[x] != cwd_raw2$Transect[x + 1], x, NA)
  }) %>% data.frame() %>% na.omit(.) 

cwd_tab <- kable(cwd_raw2 %>% select(-SQ), format = 'html', align = 'c') %>% 
           kable_styling(fixed_thead = TRUE, bootstrap_options = 'condensed', full_width = TRUE,
                         position = 'left', font_size = 12) %>% 
           row_spec(c(0, nrow(cwd_raw2)), extra_css = 'border-bottom: 1px solid #000000;') %>% 
           row_spec(row_changes_cwd[,1], extra_css = "border-bottom: 1px solid #000000;") %>% 
           column_spec(1, border_left = TRUE) %>% column_spec(9, border_right = TRUE) %>% 
           column_spec(1:9, border_right = TRUE, extra_css = "border-right: 1px solid #CACACA;") %>% 
           column_spec(1:10, background = ifelse(cwd_raw2$Team == "QAQC", "#DADADA", "#ffffff")) %>% 
           column_spec(10, border_right = TRUE)

cwd_sum_tab <- kable(cwd_comp2 %>% select(-vol_dif), format = 'html', align = 'c', 
                     col.names = c("Species", "Decay", "Crew", "QAQC", "Crew", "QAQC")) %>% 
               kable_styling(fixed_thead = TRUE, bootstrap_options = 'condensed', full_width = FALSE,
                             position = 'left', font_size = 14) %>% 
               add_header_above(c("", "", "CWD volume (m^3/ha)" = 2, "# pieces" = 2),
                            extra_css = "border-bottom: 1px solid #000000; border-right: 3px solid #ffffff;",
                            line = FALSE) %>% 
               row_spec(c(0, nrow(cwd_comp2)), extra_css = 'border-bottom: 1px solid #000000;') %>% 
               row_spec(nrow(cwd_comp2), extra_css = 'border-top: 1px solid #000000;', bold = TRUE) %>%
               column_spec(3:4, background = check_pct_diff(cwd_comp2, "CWD_Vol_C", "CWD_Vol_Q", "vol_dif")) %>% 
               column_spec(5:6, background = case_when(cwd_comp2$Species != "CWD Total" & 
                                                         abs(cwd_comp2$num_pieces_C - cwd_comp2$num_pieces_Q) > 0 ~ diff_ok,
                                                       cwd_comp2$Species == "CWD Total" &
                                                         abs(cwd_comp2$num_pieces_C - cwd_comp2$num_pieces_Q) > 0 ~ diff_bad,
                                                     TRUE ~ "#fffff")) %>% 
               column_spec(c(1, 2, 4, 6), border_right = T) %>% column_spec(1, border_left = T) %>% 
               column_spec(c(3, 5), border_right = T, extra_css = "border-right: 1px solid #CACACA;" )

```

```{r, soil_tabs, include = SOILSAMPLE}
if(SOILSAMPLE == TRUE){
soil_table <- kable(soil_comp, format = "html", align = "c", col.names = c("Sample", rep(c("Crew", "QAQC"), 4))) %>% 
              kable_styling(fixed_thead = TRUE, bootstrap_options = 'condensed', full_width = FALSE,
                             position = 'left', font_size = 14) %>% 
              add_header_above(c("", "Litter Depth" = 2, "O Horizon" = 2, "A Horizon" = 2, "Total Depth" = 2),
                            extra_css = "border-bottom: 1px solid #000000; border-right: 3px solid #ffffff;",
                            line = FALSE) %>% 
              row_spec(c(0, nrow(soil_comp)), extra_css = 'border-bottom: 1px solid #000000;') %>% 
              column_spec(1, border_left = TRUE) %>% 
              column_spec(c(1, seq(3, 9, 2)), border_right = TRUE) %>%
              column_spec(seq(2, 8, 2), border_right = TRUE, extra_css = "border-right: 1px solid #CACACA;") %>% 
              column_spec(2:3, background = ifelse(soil_comp$Litter_C == soil_comp$Litter_Q, "#ffffff", diff_ok)) %>% 
              column_spec(4:5, background = ifelse(soil_comp$O_hor_C == soil_comp$O_hor_Q, "#ffffff", diff_ok)) %>% 
              column_spec(6:7, background = ifelse(soil_comp$A_hor_C == soil_comp$A_hor_Q, "#ffffff", diff_ok)) %>% 
              column_spec(8:9, background = ifelse(soil_comp$Total_Depth_C == soil_comp$Total_Depth_Q, "#ffffff", diff_ok))
}
```

### Stand {.tabset .tabset-pills}

<h3>Stand Characteristics</h3>
```{r, echo = FALSE}
site_char_tab
```
<br>

<h3>Stand % Cover Metrics</h3>
```{r, echo = FALSE}
pct_tab
```
<br>

<div class='column_1'>
<h3>Stand Height</h3>
```{r, echo = FALSE}
trht_tab
```
</div>

<div class='column_2'>
<h3>Disturbances</h3>
```{r, echo = FALSE}
dist_tab
```
</div>


### Tree {.tabset}

#### Tree Data {.tabset}
```{r, tree_table, echo = FALSE}
tree_tab

diff_plot
```

#### Conditions
```{r, cond_table, echo = FALSE}
trcond_tab
```
Note: Trees in grey are dead.

#### Foliage Conditions
```{r, fol_table, echo = FALSE}
folcond_tab
```

### Microplot{.tabset}

#### Saplings {.tabset}
<details open><summary><h3>Individual Stems</h3></summary>
```{r, sap_table, echo = FALSE}
sap_tab
```
</details>

<details open><summary><h3>Summary</h3></summary>
```{r, sap_sum, echo = FALSE}
sap_sum_tab
```
</details>

#### Shrubs {.tabset}
```{r, shrub_table, echo = FALSE}
shrub_tab
```

#### Seedlings {.tabset}
```{r, seed_table, echo = FALSE}
seeds_tab
```

#### Regen Summary {.tabset}
```{r, regen_sum, echo = FALSE}
regen_tab
```


### Quadrats {.tabset}

#### Quadrat Data {.tabset}

```{r, quad_chr_tab, echo = FALSE}
chr_tab
```

#### Quadrat Species {.tabset}

<h4>Missed Species</h4> 
```{r quad_spp_tab, echo = FALSE}
missed_leg

spp_tab

```

#### Quadrat Species Summary {.tabset}

<h4>Missed Species</h4>
```{r quad_sum_tab, echo = FALSE}
missed_leg

spp_sum_tab
```


### Additional Species
<h4>Missed Species</h4>
```{r addspp_tab, echo = FALSE}
missed_leg

addspp_tab
```

### CWD

<details open><summary><h3>Individual Pieces</h3></summary>
```{r cwd_tab, echo = FALSE}
cwd_tab
```
</details>
<br>

<details open><summary><h3>Volume Summary</h3></summary>
```{r cwd_sum_tab, echo = FALSE}
cwd_sum_tab
```
</details>

### Soil

```{r soil_samp_title, echo = FALSE, include = SOILSAMPLE, results = 'asis'}
cat("<h3>Soil Sample Data</h3>")
```

```{r soil_samp_tab, echo = FALSE, include = SOILSAMPLE}
if(SOILSAMPLE == TRUE){
soil_table
}
```

```{r soil_samp_tabF, echo = FALSE, include = !SOILSAMPLE, results = 'asis'}
cat("<h3>Soils not sampled this year.</h3>")
```


</div>
